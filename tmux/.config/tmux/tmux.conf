# TPM {{{
# Check if TPM is installed, otherwise install it
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"
#}}}
# General behaviour {{{
set-option -g detach-on-destroy off

# Dinamically update tab and window titles on terminal
set -g set-titles on

# Turn off wrap searches (does not go over the top when finished the buffer)
set -w -g wrap-search off

# Vim-mode keybindings
set-window-option -g mode-keys vi

# Use system clipboard
set-option -g set-clipboard external

# Terminal configuration
set-option -g default-terminal "tmux-256color"
set-option -g terminal-overrides ",xterm-256color:Tc"
# set-option -sa terminal-features ",xterm-*:Tc:sitm=\E[3m"
# set-option -sa terminal-overrides ",xterm-*:Tc"
## set-option -sa terminal-features ",xterm-256color:Tc"

set -sg escape-time 0

# Image support
set -gq allow-passthrough on
set -g visual-activity off

# History limit
set-option -g history-limit 30000

# Rather than constraining window size to the maximum size of any client
# connected to the *session*, constrain window size to the maximum size of any
# client connected to *that window*. Much more reasonable.
setw -g aggressive-resize on
# }}}
# Keybindings {{{
# Setting prefix to space
unbind C-b
unbind C-a
unbind C-Space
set-option -g prefix C-Space
bind C-Space send-prefix

# Reload tmux configuration file
bind R source-file $HOME/.config/tmux/tmux.conf \; display-message "Configuration file successfully loaded"

# Create a new window with the path of the current pane
unbind c
bind c command-prompt -p "New Window name:" "new-window -c '#{pane_current_path}' -n '%%'"

# Create a new session with the path of the current pane
unbind S
bind S command-prompt -p "New Session name:" "new-session -A -s '%%'"

# Custom programs mapping
bind g new-window -n lazygit -c "#{pane_current_path}" "lazygit"

# Splits mapping
unbind %
bind '\' split-window -h -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"

unbind '"'
bind - split-window -v -c "#{pane_current_path}"

# Join windows
unbind J
bind J join-pane -s !

# Vim-like movement between panes
unbind h
bind h select-pane -L

unbind j
bind j select-pane -D

unbind k
bind k select-pane -U

unbind l
bind l select-pane -R

# Resizing mapping
unbind Left
bind -r Left resize-pane -L 1

unbind Right
bind -r Right resize-pane -R 1

unbind Down
bind -r Down resize-pane -D 1

unbind Up
bind -r Up resize-pane -U 1

# Toggle to last window
bind C-Space last-window

# Move window to the left/right
bind -n S-Left swap-window -d -t -1
bind -n S-Right swap-window -d -t +1

# Copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Clear history buffer & clear the screen
unbind C-k
bind C-k send-keys -R C-l \; clear-history
# }}}
# Status bar {{{
# Toggle status bar
bind '\' set status
# set -g status on

# Position
set-option -g status-position top

# Automatically renumbering windows
set -g renumber-windows on

# Start window and pane numbering at 1
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
# }}}
# Mouse use {{{
set -g mouse off
# }}}
# Plugins {{{
set -g @plugin "tmux-plugins/tpm"
set -g @plugin "tmux-plugins/tmux-yank"
set -g @plugin "tmux-plugins/tmux-resurrect"
set -g @plugin "tmux-plugins/tmux-continuum"
# set -g @plugin "catppuccin/tmux"
set -g @plugin "janoamaral/tokyo-night-tmux"
# }}}
# Plugins configuration {{{
# Resurrect/Continuum {{{
set -g @resurrect-dir "$HOME/.tmux/resurrect"
set -g @resurrect-capture-pane-contents "on"
set -g @resurrect-processes "vim nvim"
set -g @continuum-restore "off"
# }}}
# Catpppuccin theme {{{
# set -g @catppuccin_flavor "macchiato"
# set -g @catppuccin_status_modules_right "date_time"
# set -g @catppuccin_status_modules_left "session"
# set -g @catppuccin_status_connect_separator "yes"
# set -g @catppuccin_status_left_separator  "î‚¶"
# set -g @catppuccin_status_right_separator ""
# set -g @catppuccin_status_fill "all"
#
# set -g @catppuccin_window_status "text"
# set -g @catppuccin_window_default_fill "number"
# set -g @catppuccin_window_default_text " #W"
# set -g @catppuccin_window_current_fill "number"
# set -g @catppuccin_window_current_text " #W"
#
# set -g @catppuccin_date_time_text "%H:%M %d/%m [%-V]"
# }}}
# Tokyo-night theme {{{
set -g @tokyo-night-tmux_window_id_style fsquare
set -g @tokyo-night-tmux_pane_id_style hide
set -g @tokyo-night-tmux_zoom_id_style dsquare
set -g @tokyo-night-tmux_window_tidy_icons 0
set -g @tokyo-night-tmux_transparent 1
set -g @tokyo-night-tmux_show_hostname 0
# }}}
# Run TPM {{{
run -b "~/.tmux/plugins/tpm/tpm"
# }}}

# vim:foldmethod=marker:foldlevel=0
